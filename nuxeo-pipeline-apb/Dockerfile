FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBudXhlby1waXBlbGluZS1hcGIKZGVzY3JpcHRpb246IEpl\
bmtpbnMgcGlwZWxpbmUgZm9yIE51eGVvIENJL0NECmJpbmRhYmxlOiBmYWxzZQphc3luYzogb3B0\
aW9uYWwKdGFnczoKICAtIG51eGVvCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBKZW5raW5zIHBp\
cGVsaW5lIGZvciBOdXhlbwogIGxvbmdEZXNjcmlwdGlvbjoKICAgIEEgUGlwZWxpbmUgdGhhdCBk\
ZXBsb3lzIGEgTnV4ZW8gREVWIHByb2plY3QgaW50byBzZXZlcmFsIGVudmlyb25tZW50cwogIGRl\
cGVuZGVuY2llczogW10KICBkb2N1bWVudGF0aW9uVXJsOiAiaHR0cHM6Ly9naXRodWIuY29tL251\
eGVvL251eGVvLW9wZW5zaGlmdC9SRUFETUUubWQiCiAgaW1hZ2VVcmw6ICJodHRwczovL3d3dy5u\
dXhlby5jb20vYXNzZXRzL2ltZ3MvbG9nbzM0MHg2MC5wbmciCnBsYW5zOgogIC0gbmFtZTogZGVm\
YXVsdAogICAgZGVzY3JpcHRpb246IERldmVsb3BtZW50IHdpdGggR2l0IFJlcG9zaXRvcnkKICAg\
IGZyZWU6IHRydWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFyYW1ldGVyczoKICAgICAgLSBuYW1l\
OiBwcm9qZWN0X25hbWUKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogUHJvamVj\
dCBOYW1lCiAgICAgICAgZGlzcGxheV9ncm91cDogUHJvamVjdCBwcm9wZXJ0aWVzCiAgICAgIC0g\
bmFtZTogcGlwZWxpbmVfbmFtZQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBQ\
aXBlbGluZSBOYW1lCiAgICAgICAgZGVmYXVsdDogZGVmYXVsdAogICAgICAgIGRpc3BsYXlfZ3Jv\
dXA6IFByb2plY3QgcHJvcGVydGllcwogICAgICAtIG5hbWU6IHBpcGVsaW5lX2dpdF9yZWYKICAg\
ICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogR2l0IHJlZmVyZW5jZSBmb3IgdGhhdCBw\
aXBlbGluZSAob3B0aW9uYWwpCiAgICAgICAgZGlzcGxheV9ncm91cDogUHJvamVjdCBwcm9wZXJ0\
aWVzCiAgICAgIC0gbmFtZTogcGlwZWxpbmVfZGVmaW5pdGlvbgogICAgICAgIGRlZmF1bHQ6ICd1\
YXQtZGV2JwogICAgICAgIHR5cGU6IGVudW0KICAgICAgICBlbnVtOiBbJ3VhdC1kZXYnLCdzaW5n\
bGUnLCAnc3R1ZGlvJ10KICAgICAgICB0aXRsZTogUGlwZWxpbmUgZGVmaW5pdGlvbiB0byB1c2UK"



ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-pipeline-apb

RUN chmod -R g=u /opt/{ansible,apb}

USER apb