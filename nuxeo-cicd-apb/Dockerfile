FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWNpY2QtYXBiCmRlc2NyaXB0aW9uOiBDSS9DRCBkZXBs\
b3ltZW50IGluIE9wZW5zaGlmdCBmb3IgTnV4ZW8KYmluZGFibGU6IGZhbHNlCmFzeW5jOiBvcHRp\
b25hbAp0YWdzOgogIC0gbnV4ZW8KICAtIGplbmtpbnMKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6\
IENJL0NEIGVudmlyb25tZW50IGZvciBOdXhlbyBEZXZlbG9wbWVudAogIGNvbnNvbGUub3BlbnNo\
aWZ0LmlvL2ljb25DbGFzczogaWNvbi1qZW5raW5zCiAgbG9uZ0Rlc2NyaXB0aW9uOgogICAgVGhp\
cyBiYXNpY2FsbHkgZGVwbG95cyBKZW5raW5zIGFuZCBOZXh1cwogIGRlcGVuZGVuY2llczogW10K\
ICBkb2N1bWVudGF0aW9uVXJsOiAiaHR0cHM6Ly9naXRodWIuY29tL251eGVvL251eGVvLW9wZW5z\
aGlmdC9SRUFETUUubWQiCiAgcHJvdmlkZXJEaXNwbGF5TmFtZTogIk51eGVvIgpwbGFuczoKICAt\
IG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBEZWZhdWx0IENJL0NEIGRlcGxveW1lbnQK\
ICAgIGZyZWU6IHRydWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFyYW1ldGVyczoKICAgIC0gbmFt\
ZTogcHJvamVjdF9uYW1lCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogUHJvamVjdCBO\
YW1lCiAgICAgIGRpc3BsYXlfZ3JvdXA6IFByb2plY3QgcHJvcGVydGllcwogICAgLSBuYW1lOiBk\
b21haW5fc3VmZml4CiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogRG9tYWluIHN1ZmZp\
eCBmb3Igcm91dGVzCiAgICAgIGRlZmF1bHQ6IGFwcHMucHJvZC5udXhlby5pbwogICAgICBkaXNw\
bGF5X2dyb3VwOiBQcm9qZWN0IHByb3BlcnRpZXMKICAgIC0gbmFtZTogbmV4dXNfYWRtaW5fdXNl\
cgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgZGVmYXVsdDogYWRtaW4KICAgICAgdGl0bGU6IEFk\
bWluaXN0cmF0b3IgdXNlciBuYW1lCiAgICAgIGRpc3BsYXlfZ3JvdXA6IE5leHVzIGNvbmZpZ3Vy\
YXRpb24KICAgIC0gbmFtZTogbmV4dXNfYWRtaW5fcGFzc3dvcmQKICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgIHRpdGxlOiBBZG1pbmlzdHJhdG9yIHVzZXIgcGFzc3dvcmQgKGdlbmVyYXRlZCBpZiBu\
b25lIGdpdmVuKQogICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAgIGRpc3BsYXlfZ3Jv\
dXA6IE5leHVzIGNvbmZpZ3VyYXRpb24KICAgIC0gbmFtZTogbmV4dXNfYWRtaW5fZW1haWwKICAg\
ICAgdHlwZTogc3RyaW5nCiAgICAgIGRlZmF1bHQ6IGRldm51bGxAbnV4ZW8uY29tCiAgICAgIHRp\
dGxlOiBBZG1pbmlzdHJhdG9yIEVtYWlsIGFkcmVzcwogICAgICBkaXNwbGF5X2dyb3VwOiBOZXh1\
cyBjb25maWd1cmF0aW9uCiAgICAtIG5hbWU6IG5leHVzX3N0b3JhZ2VfY2xhc3MKICAgICAgdHlw\
ZTogc3RyaW5nCiAgICAgIGRlZmF1bHQ6IHNoYXJlZAogICAgICB0aXRsZTogTmV4dXMgc3RvcmFn\
ZSBjbGFzcwogICAgICBkaXNwbGF5X2dyb3VwOiBOZXh1cyBjb25maWd1cmF0aW9uCiAgICAtIG5h\
bWU6IG5leHVzX3N0b3JhZ2VfY2FwYWNpdHkKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIGRlZmF1\
bHQ6IDJHaQogICAgICB0aXRsZTogTmV4dXMgc3RvcmFnZSBjYXBhY2l0eQogICAgICBkaXNwbGF5\
X2dyb3VwOiBOZXh1cyBjb25maWd1cmF0aW9uCiAgICAtIG5hbWU6IGdpdF9zc2hfc2VjcmV0X25h\
bWVfb3ZlcnJpZGUKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBOYW1lIG9mIHRoZSBz\
ZWNyZXQgY29udGFpbmluZyB0aGUgU1NIIGtleSB0byBhY2Nlc3MgZ2l0CiAgICAgIGRpc3BsYXlf\
Z3JvdXA6IEplbmtpbnMgY29uZmlndXJhdGlvbgo="


ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-cicd-apb/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb